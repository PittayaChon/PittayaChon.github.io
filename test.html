<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>


    <script src="https://api.longdo.com/map/?key=d0de38067fc4c0774a1e4c8174edaea1"></script>


    <h2>HTML Forms</h2>
    <script>

    //alert("Hello world3 !!!") ;
    </script>


    <div class="container">
        <div class="card">
            <img class="card-img-top" src="..." alt="Card image cap">
            <div class="card-body">

                <div id="map" style="width:100%;  height:600px;"></div>



            </div>
        </div>

        <div class="card">
            
            <div class="card-body">

                <input id="material_code" class="form-control form-control-lg" type="text">

                <button onclick="search_material()" type="button" class="btn btn-primary">Primary</button>

            </div>
        </div>
    </div>


    <script>
        var material;
        function search_material() {


            let search_material_result = material.filter(function (value) {
                // console.log(value.abbr);
                return value.code == document.getElementById("material_code").value;
            });
            console.log("search_material_result", search_material_result) ;
            alert(search_material_result)
        }


        axios({
            method: 'get',
            url: 'https://gist.githubusercontent.com/ChaiyachetU/eb18cb962af268f12825d7c8dc65d570/raw/caf1f611babb5bcd305b673ba47c086340dd0136/pea_material_data.json'
        })
            .then(response => {
                material = response.data;

                axios({
                    method: 'get',
                    url: 'https://gist.githubusercontent.com/ChaiyachetU/56fc961f59719d6d078c00f00328a2b4/raw/e23a1a0f4f35ce04c73f930142460bd42b164291/substation_pea.json'
                })
                    .then(response => {

                        //console.log({"area: ": response.data[1].name } )
                        let area = response.data;
                        var map = new longdo.Map({
                            placeholder: document.getElementById('map')
                        });

                        var province_group = [];
                        var province_group_count = [];
                        var area_stringify = JSON.stringify(area).toString();

                        area_stringify = area_stringify.replace(/latitude\s/g, "latitude");
                        area_stringify = area_stringify.replace(/longitude\s/g, "longitude");
                        console.log("area_stringify: ", area_stringify)
                        // var area_stringify = area_stringify.replace("latitude ", "latitude");
                        area = JSON.parse(area_stringify);
                        console.log("area: ", area)


                        for (let i = 0; i < area.length; i++) {
                            // console.log("province " ,area[i]["province"]   ) ;
                            // console.log("latitude " ,area[i]['latitude']   ) ;
                            // console.log("longitude " ,area[i]['longitude']  )

                            var marker1 = new longdo.Marker({ lon: area[i]['longitude'], lat: area[i]['latitude'] },
                                {
                                    title: area[i]["region_area"],
                                    icon: {
                                        url: 'https://map.longdo.com/mmmap/images/pin_mark.png',
                                        offset: { x: 12, y: 45 }
                                    },
                                    detail: '<b>' + area[i]["name"] + '<b><br>' + '' + area[i]["abbr"],
                                    visibleRange: { min: 2, max: 15 },
                                    draggable: true,
                                    weight: longdo.OverlayWeight.Top,
                                });
                            map.Overlays.add(marker1);
                            // if (province_group.indexOf(area[i].province) < 0) {
                            //     province_group.push(area[i].province);
                            //     province_group_count.push({ "province": area[i].province, "count": "0" });
                            // }
                            //     else {

                            //     }
                        }

                        //  console.log("area: ", area)
                        let area_filter = area.filter(function (value) {
                            // console.log(value.abbr);
                            return value.id == 3;
                        });
                        console.log("area_filter: ", area_filter)

                        let count = area.reduce(function (object, currentValue, index) {
                            if (typeof object[currentValue.province] === 'undefined') {
                                object[currentValue.province] = 1;
                            } else {
                                object[currentValue.province]++;
                            }
                            return object;
                        }, {});

                        console.log('counted:', count);


                        sessionStorage.setItem("area_filter", JSON.stringify(area_filter));

                        //  window.location.href = "index.html";



                    })
                    .catch(err => {
                        console.error("area", err);
                    })

            })
            .catch(err => {
                console.error("material", err);
            })



    </script>
</body>

</html>